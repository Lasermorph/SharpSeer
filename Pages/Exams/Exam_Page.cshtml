@page
@using SharpSeer.Models
@using static SharpSeer.Models.Exam
@using System.Linq
@model SharpSeer.Pages.Exams.Exam_PageModel
@{
}

<body class="background"></body>
<body class="@((Model.SetOverflow) ? "noScroll": "")">


<a class="btn btn-primary" href="/Exams/Exam_Page/?Create=0">Tilføj</a>

	<form method="get" class="search-form">
		<table class="table table-search">
			<thead>
				<tr>
		        	<th><input type="text" class="form-control" asp-for="Name" placeholder="Navn" /></th>
					<th>
						<select asp-for="ExamType"
								asp-items="Html.GetEnumSelectList<ExamTypeEnum>()"
								class="form-select">
							<option value="">Eksamens type</option>
						</select>
					</th>

					<th>
						<select name="teachers" id="teacher" class="form-select">
							<option value="">Navn på underviseren</option>
							@foreach (var teacher in Model.TeachersAll)
							{
								<option value="@teacher.Id">@teacher.Name</option>
							}
						</select>
					</th>
				<th>
						<select name="cohorts" id="cohort"class="form-select">
						<option value="">Navn på hold</option>
						@foreach (var cohort in Model.CohortsAll)
						{
							<option value="@cohort.Id">@cohort.Name</option>
						}
			        	</select>
				</th>

				<th>
					<th>
						<select asp-for="IsGuarded" class="form-select">
							<option value="">Alle</option>
							<option value="true">Ja</option>
							<option value="false">Nej</option>
						</select>
					</th>

					<th>
						<select asp-for="NeedExternalExaminer" class="form-select">
							<option value="">Alle</option>
							<option value="true">Ja</option>
							<option value="false">Nej</option>
						</select>
					</th>

			<th><input type="datetime" class="form-control" asp-for="FirstExamDate" placeholder="Første eksamens dag" /></th>
			<th><input type="datetime" class="form-control" asp-for="LastExamDate" placeholder="Sidste eksamens dag" /></th>
			<th><input type="datetime" class="form-control" asp-for="HandInDeadline" placeholder="Deadline for aflevering, hvis skriftlig" /></th>
			<th><input type="number" min="0" class="form-control" asp-for="DurationInMinutes" placeholder="Eksamens varighed" /></th>
			<th>
				<button type="submit" class="btn btn-search">Søg</button>
					</th>
				</tr>
			</thead>
		</table>
	</form>

	<table class="table table-showup">
		<thead>
			<tr>
				<th>Navn</th>
				<th>Eksamens Type</th>
				<th>Hold</th>
				<th>Underviser(e)</th>
				<th>Med vagt?</th>
				<th>Ekstern Censor?</th>
				<th>Eksamens Start</th>
				<th>Eksamens Slut</th>
				<th>Deadline for aflevering</th>
				<th>Eksmaens varighed</th>
				<th></th>
			    <th></th>
			</tr>
		</thead>
		<tbody>
			@foreach (var exam in Model.Exams)
			{
				<tr> 
					<td> 
						@exam.Name </td>
						<td> 
							@((ExamTypeEnum)exam.ExamType) 
						</td>
							<td scope="col"> @((exam.Cohorts?.Any() ?? false) ? string.Join(", ", exam.Cohorts.Select(c => c.Name)) : "Ingen hold tilknyttet") </td>
							<td scope="col"> @((exam.Teachers?.Any() ?? false) ? string.Join(", ", exam.Teachers.Select(t => t.Name)) : "Ingen underviser tilknyttet") </td> 
							<td> @(exam.IsGuarded ? "Ja" : "Nej") </td> <td> @(exam.NeedExternalExaminer ? "Ja" : "Nej") </td> <td> @exam.FirstExamDate </td> <td> @exam.LastExamDate </td>
							<td> @exam.HandInDeadline </td> 
							<td> @exam.DurationInMinutes minutter </td> 
						    	<td> <form method="get"> <a href="/Exams/Exam_page/?Update=@exam.Id" class="btn btn-primary" style="float: left;" type="submit"> Opdater </a> </form></td> 
								<td> <form method="get"> <a href="/Exams/Exam_Page/?Delete=@exam.Id" class="btn btn-danger" style="margin-left: 1rem;" type="submit"> Slet </a> </form></td> 
			    </tr>
			}
		</tbody>
	</table>
	

@if (Model.ShowDelete)
{

	<!-- Modal -->
		<div style="display: block;" class="modal" id="myModal">
		<div class="modal-dialog">
			<div class="modal-content">
				<!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">Er du sikker på du vil slette denne eksamen?</h4>
					<a href="/Exams/Exam_Page" type="button" class="btn btn-close"></a>
				</div>
				<!-- Modal body -->
				<div class="modal-body">
					@Model.Exam.Name
				</div>
				<!-- Modal footer -->
				<div class="modal-footer">
					<form method="post" asp-route-id="@Model.Exam.Id" asp-page-handler="Delete">
					<button type="submit" class="btn btn-danger">Ja</button>
					</form>
					<a href="/Exams/Exam_Page" type="button" class="btn btn-primary">Nej</a>
				</div>
			</div>
		</div>
	</div>
}	
@if (Model.ShowCreate)
{
	
	<!-- Modal -->
	<div style="display: block;" class="modal" id="myModal">
		<div class="modal-dialog">
			<div class="modal-content">
				<!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">Tilføj ny eksamen</h4>
					<a href="/Exams/Exam_Page" type="button" class="btn btn-close"></a>
				</div>
				<!-- Modal body -->
				<form method="post" asp-page-handler="Create">
					<div class="modal-body">
						<table class="table">
							<tbody>
								<tr>
									<th scope="col">
										Navn
									</th>
									<td>
										<input asp-for="Exam.Name" class="form-control" required />
									</td>
								</tr>
								<tr>
									<th scope="col">
										Eksamens type
									</th>
									<td>
										<label>Vælg type</label>
										<select asp-for="ExamType" asp-items="Html.GetEnumSelectList<ExamTypeEnum>()" class="form-select">
										</select>
									</td>
								</tr>
								<tr>
									<th scope="col">
										Hold
									</th>
									<td>
										<div style="height:80px;overflow-y:scroll" >
											@foreach (var cohort in Model.CohortsAll)
											{
													<input class="form-check-inline" name="Cohorts" type="checkbox" value="@cohort.Id" @(Model.Cohorts != null && Model.Cohorts.Contains(cohort.Id) ? "checked" : "") />
												@cohort.Name
												<br />
											}
										</div>
                                            <span asp-validation-for="Cohorts" class="text-danger"></span>
									</td>
									
								</tr>

								<tr>
									<th scope="col">
										Underviser(e)
									</th>
									<td>
										<div style="height:80px;overflow-y:scroll">
											
											@foreach (var teacher in Model.TeachersAll)
											{
													<input class="form-check-inline" name="Teachers" type="checkbox" value="@teacher.Id" @(Model.Teachers != null && Model.Teachers.Contains(teacher.Id) ? "checked" : "") />
												@teacher.Name
												<br />
											}
										</div>
										<span asp-validation-for="Teachers" class="text-danger"></span>

									</td>
								</tr>

								<tr>
									<th scope="col">
										Med vagt
									</th>
									<td>
										<select asp-for="IsGuarded" class="form-select">
											<option value="">Alle</option>	
											<option value="true">Ja</option>
											<option value="false">Nej</option>
										</select>
									</td>
								</tr>
								<tr>
									<th scope="col">
										Ekstern censor
									</th>
									<td>
										<select asp-for="NeedExternalExaminer" class="form-select">
											<option value="">Alle</option>
											<option value="true">Ja</option>
											<option value="false">Nej</option>
										</select>
									</td>
								</tr>
								<tr>
									<th scope="col">
										Eksamens start
									</th>
									<td>
											<input asp-for="Exam.FirstExamDate" class="form-control"/>
									</td>
								</tr>
								<tr>
									<th scope="col">
										Eksamens Slut
									</th>
									<td>
											<input asp-for="Exam.LastExamDate" class="form-control"/>
									</td>
								</tr>
								<tr>
									<th scope="col">
										Deadline for aflevering
									</th>
									<td>
										<input asp-for="Exam.HandInDeadline" class="form-control" />
									</td>
								</tr>
								<tr>
									<th scope="col">
										Eksmaens varighed
									</th>
									<td>
											<input asp-for="Exam.DurationInMinutes" class="form-control" required />
									</td>
                                </tr>
                            </tbody>
						</table>
					</div>
					<!-- Modal footer -->
					<div class="modal-footer">
					
						<button type="submit" class="btn btn-primary">Opret</button>
						<a href="/Exams/Exam_Page" type="button" class="btn btn-danger">Annuller</a>
					</div>
				</form>
			</div>
		</div>
	</div>
}

@if (Model.ShowUpdate)
{
	
	<!-- Modal -->
	<div style="display: block;" class="modal" id="myModal">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">Opdater eksamen</h4>
					<a href="/Exams/Exam_Page" type="button" class="btn btn-close"></a>
				</div>
				<!-- Modal body -->
			
				<form method="post" asp-page-handler="Update" asp-route-id="@Model.Exam.Id">
				<div class="modal-body">
					<table class="table">
						<thead>
							<tr>
								<th></th>
								<th>
									Oprindelig information
								</th>
								<th>
									Opdateret information
								</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th scope="col">
									Navn
								</th>
								<td>
									@Model.Exam.Name
								</td>
								<td>
									<input asp-for="Exam.Name" class="form-control" />
								</td>
							</tr>
							<tr>
								<th scope="col">
									Eksamens type
								</th>
								<td>
									@((ExamTypeEnum)Model.Exam.ExamType)
								</td>
								<td>
									<select asp-for="ExamType" asp-items="Html.GetEnumSelectList<ExamTypeEnum>()" class="form-select">
									</select>
								</td>
								
							</tr>
							<tr>
								<th scope="col">
									Hold
								</th>
								<td scope="col">
									@((Model.Exam.Cohorts?.Any() ?? false)
											? string.Join(", ", Model.Exam.Cohorts.Select(c => c.Name)) : "Ingen hold tilknyttet")
								</td>
								<td>
										<div style="height:80px;overflow-y:scroll">
										@foreach (var cohort in Model.CohortsAll)
											{
													<input class="form-check-inline" name="Cohorts" type="checkbox" value="@cohort.Id" @(Model.Cohorts != null && Model.Cohorts.Contains(cohort.Id) ? "checked" : "") />
												@cohort.Name
												<br />
											}
									</div>
								</td>

							</tr>
							<tr>
								<th scope="col">
									Underviser(e)
								</th>
								<td scope="col">
									@((Model.Exam.Teachers?.Any() ?? false)
										? string.Join(", ", Model.Exam.Teachers.Select(t => t.Name)) : "Ingen underviser tilknyttet")
								</td>
								<td>
									@foreach (var teacher in Model.TeachersAll)
										{
												<input class="form-check-inline" name="Teachers" type="checkbox" value="@teacher.Id" @(Model.Teachers != null && Model.Teachers.Contains(teacher.Id) ? "checked" : "") />
											@teacher.Name
											<br />
										}
								</td>
							</tr>
							<tr>
								<th scope="col">
									Med vagt
								</th>
								<td>
										@(Model.Exam.IsGuarded  ? "Ja" : "Nej")
                                </td>
								<td>
											<select asp-for="Exam.IsGuarded" class="form-select">
												<option value="true">Ja</option>
												<option value="false">Nej</option>
											</select>
									</td>
								</tr>

								<tr>
									<td>Ekstern censor</td>
									<td>@(Model.Exam.NeedExternalExaminer ? "Ja" : "Nej")</td>
									<td>
											<select asp-for="Exam.NeedExternalExaminer" class="form-select">
												<option value="true">Ja</option>
												<option value="false">Nej</option>
											</select>
									</td>
								</tr>

								<tr>
									<td>Eksamens start</td>
									<td>@Model.Exam.FirstExamDate</td>
									<td>
										<input asp-for="Exam.FirstExamDate" class="form-control" />
									</td>
								</tr>

								<tr>
									<td>Eksamens slut</td>
									<td>@Model.Exam.LastExamDate</td>
									<td>
										<input asp-for="Exam.LastExamDate" class="form-control" />
									</td>
								</tr>

								<tr>
									<td>Deadline for aflevering</td>
									<td>@Model.Exam.HandInDeadline</td>
									<td>
										<input asp-for="Exam.HandInDeadline" class="form-control" />
									</td>
								</tr>

								<tr>
									<td>Eksamens varighed (minutter)</td>
									<td>@Model.Exam.DurationInMinutes</td>
									<td>
										<input asp-for="Exam.DurationInMinutes" class="form-control" />
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				<!-- Modal footer -->
				<div class="modal-footer">
					
					<button type="submit" class="btn btn-primary">Opdater</button>
					<a href="/Exams/Exam_Page" type="button" class="btn btn-danger">Annuller</a>
				</div>
				</form>
			</div>
		</div>
	</div>
}

@if (Model.ShowCalendar)
{

}
</body>








@section Scripts 
{
	<script>
		$(document).ready(function () {
			$("#myModal").modal({backdrop: "static"});
			$("#myModal").modal("show");
		});)
	</script>	
}